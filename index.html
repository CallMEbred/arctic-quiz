<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tundra Challenge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(180deg, #1a3a52 0%, #2d5f7f 50%, #4a7fa0 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
            position: relative;
            overflow-x: hidden;
        }

        /* Snowflake Animation */
        .snowflake {
            position: fixed;
            top: -10px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1em;
            animation: fall linear infinite;
            z-index: 1;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 30px;
            background: rgba(255, 255, 255, 0.08);
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            letter-spacing: 3px;
            animation: titlePulse 3s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            font-style: italic;
        }

        .challenge-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .challenge-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 25px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.4s ease;
            font-size: 1.2em;
            font-weight: bold;
            font-family: 'Georgia', serif;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .challenge-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .challenge-btn.active {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .challenge-section {
            display: none;
        }

        .challenge-section.active {
            display: block;
            animation: fadeSlide 0.8s ease;
        }

        @keyframes fadeSlide {
            from { 
                opacity: 0; 
                transform: translateY(30px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .instructions {
            background: rgba(255, 255, 255, 0.12);
            padding: 25px;
            border-radius: 5px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.2);
        }

        .instructions h2 {
            margin-bottom: 12px;
            font-size: 1.8em;
        }

        .instructions p {
            font-size: 1.1em;
            line-height: 1.6;
        }

        .challenge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .animal-card, .quiz-card {
            background: rgba(255, 255, 255, 0.92);
            color: #1a3a52;
            padding: 25px;
            border-radius: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
            transition: all 0.4s ease;
            border: 2px solid rgba(26, 58, 82, 0.1);
        }

        .animal-card:hover, .quiz-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.35);
        }

        .animal-card.selected-yes {
            border: 3px solid #2e7d32;
            background: rgba(76, 175, 80, 0.15);
            animation: selectPulse 0.5s ease;
        }

        .animal-card.selected-no {
            border: 3px solid #c62828;
            background: rgba(244, 67, 54, 0.15);
            animation: selectPulse 0.5s ease;
        }

        @keyframes selectPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .animal-name, .quiz-question {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 18px;
            text-align: center;
            color: #1a3a52;
        }

        .button-group {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: 2px solid transparent;
            border-radius: 4px;
            font-size: 1.05em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
        }

        .btn-yes {
            background: #2e7d32;
            color: white;
            border-color: #1b5e20;
        }

        .btn-yes:hover {
            background: #1b5e20;
            transform: scale(1.08);
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.4);
        }

        .btn-no {
            background: #c62828;
            color: white;
            border-color: #8e0000;
        }

        .btn-no:hover {
            background: #8e0000;
            transform: scale(1.08);
            box-shadow: 0 4px 12px rgba(198, 40, 40, 0.4);
        }

        .btn-option {
            background: #1565c0;
            color: white;
            border-color: #0d47a1;
            flex: 1;
            min-width: 140px;
        }

        .btn-option:hover {
            background: #0d47a1;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(21, 101, 192, 0.4);
        }

        .btn-option.selected {
            background: #2d5f7f;
            border-color: #1a3a52;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .matching-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .matching-column {
            background: rgba(255, 255, 255, 0.92);
            padding: 25px;
            border-radius: 5px;
            border: 2px solid rgba(26, 58, 82, 0.2);
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.2);
        }

        .matching-column h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #1a3a52;
            font-size: 1.5em;
        }

        .matching-item {
            background: #1565c0;
            color: white;
            padding: 18px;
            margin: 12px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.4s ease;
            text-align: center;
            font-weight: bold;
            border: 2px solid #0d47a1;
        }

        .matching-item:hover {
            transform: scale(1.05);
            background: #0d47a1;
            box-shadow: 0 4px 15px rgba(21, 101, 192, 0.4);
        }

        .matching-item.selected {
            background: #2d5f7f;
            border-color: #1a3a52;
            animation: matchPulse 0.6s ease infinite;
        }

        @keyframes matchPulse {
            0%, 100% { box-shadow: 0 0 10px rgba(45, 95, 127, 0.5); }
            50% { box-shadow: 0 0 20px rgba(45, 95, 127, 0.8); }
        }

        .matching-item.matched {
            background: #2e7d32;
            border-color: #1b5e20;
            cursor: default;
            animation: matchSuccess 0.6s ease;
        }

        @keyframes matchSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .submit-section {
            text-align: center;
            margin-top: 40px;
        }

        .btn-submit {
            background: linear-gradient(135deg, #2d5f7f 0%, #1a3a52 100%);
            color: white;
            padding: 18px 45px;
            font-size: 1.3em;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            font-family: 'Georgia', serif;
            font-weight: bold;
        }

        .btn-submit:hover:not(:disabled) {
            transform: scale(1.08);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .btn-submit:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .results {
            background: rgba(255, 255, 255, 0.95);
            color: #1a3a52;
            padding: 35px;
            border-radius: 5px;
            margin-top: 40px;
            display: none;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(26, 58, 82, 0.2);
        }

        .results.show {
            display: block;
            animation: resultsAppear 0.8s ease;
        }

        @keyframes resultsAppear {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .score {
            font-size: 2.2em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .score.pass {
            color: #2e7d32;
            animation: successGlow 1.5s ease-in-out infinite;
        }

        @keyframes successGlow {
            0%, 100% { text-shadow: 0 0 10px rgba(46, 125, 50, 0.5); }
            50% { text-shadow: 0 0 20px rgba(46, 125, 50, 0.8); }
        }

        .score.fail {
            color: #c62828;
        }

        .answer-list {
            margin-top: 25px;
        }

        .answer-item {
            padding: 12px;
            margin: 8px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .answer-item:hover {
            transform: translateX(5px);
        }

        .answer-item.correct {
            background: rgba(46, 125, 50, 0.15);
            border-color: rgba(46, 125, 50, 0.3);
        }

        .answer-item.incorrect {
            background: rgba(198, 40, 40, 0.15);
            border-color: rgba(198, 40, 40, 0.3);
        }

        .progress {
            text-align: center;
            margin: 25px 0;
            font-size: 1.2em;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            font-weight: bold;
        }

        .final-summary-card {
            background: rgba(255, 255, 255, 0.95);
            color: #1a3a52;
            padding: 40px;
            border-radius: 5px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            border: 3px solid rgba(26, 58, 82, 0.3);
            animation: fadeSlide 0.8s ease;
        }

        .final-title {
            font-size: 3em;
            text-align: center;
            margin-bottom: 15px;
            color: #1a3a52;
            text-transform: uppercase;
            letter-spacing: 3px;
            animation: titlePulse 3s ease-in-out infinite;
        }

        .final-subtitle {
            font-size: 1.4em;
            text-align: center;
            margin-bottom: 40px;
            color: #2d5f7f;
            font-style: italic;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .summary-item {
            background: rgba(26, 58, 82, 0.05);
            padding: 25px;
            border-radius: 5px;
            border: 2px solid rgba(26, 58, 82, 0.2);
            text-align: center;
            transition: all 0.4s ease;
        }

        .summary-item.passed {
            background: rgba(46, 125, 50, 0.1);
            border-color: #2e7d32;
            animation: successPulse 2s ease-in-out infinite;
        }

        .summary-item.failed {
            background: rgba(198, 40, 40, 0.1);
            border-color: #c62828;
        }

        @keyframes successPulse {
            0%, 100% { box-shadow: 0 0 10px rgba(46, 125, 50, 0.3); }
            50% { box-shadow: 0 0 25px rgba(46, 125, 50, 0.6); }
        }

        .summary-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #1a3a52;
        }

        .summary-status {
            font-size: 1.5em;
            font-weight: bold;
            padding: 10px;
            border-radius: 4px;
        }

        .summary-item.passed .summary-status {
            color: #2e7d32;
            background: rgba(46, 125, 50, 0.15);
        }

        .summary-item.failed .summary-status {
            color: #c62828;
            background: rgba(198, 40, 40, 0.15);
        }

        .final-result {
            margin-top: 40px;
            padding: 30px;
            background: rgba(26, 58, 82, 0.08);
            border-radius: 5px;
            border: 3px solid rgba(26, 58, 82, 0.2);
        }

        .final-score {
            font-size: 2.5em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .final-result.overall-pass .final-score {
            color: #2e7d32;
            animation: successGlow 1.5s ease-in-out infinite;
        }

        .final-result.overall-fail .final-score {
            color: #c62828;
        }

        .final-message {
            font-size: 1.3em;
            text-align: center;
            color: #2d5f7f;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .matching-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }

            .final-title {
                font-size: 2em;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>TUNDRA CHALLENGE</h1>
            <p class="subtitle">Test Your Arctic Knowledge</p>
        </header>

        <div class="challenge-selector" id="challengeSelector">
            <button class="challenge-btn active" onclick="switchChallenge(1)">Animal Identification</button>
            <button class="challenge-btn" onclick="switchChallenge(2)">Trivia Quiz</button>
            <button class="challenge-btn" onclick="switchChallenge(3)">Adaptation Matching</button>
            <button class="challenge-btn" onclick="switchChallenge(4)">Plant Identification</button>
        </div>

        <!-- Final Summary Screen -->
        <div id="finalSummary" class="challenge-section">
            <div class="final-summary-card">
                <h2 class="final-title">Challenge Complete!</h2>
                <div class="final-subtitle">You have finished all segments</div>
                
                <div class="summary-grid">
                    <div class="summary-item" id="summary1">
                        <div class="summary-name">Animal Identification</div>
                        <div class="summary-status">Not Completed</div>
                    </div>
                    <div class="summary-item" id="summary2">
                        <div class="summary-name">Trivia Quiz</div>
                        <div class="summary-status">Not Completed</div>
                    </div>
                    <div class="summary-item" id="summary3">
                        <div class="summary-name">Adaptation Matching</div>
                        <div class="summary-status">Not Completed</div>
                    </div>
                    <div class="summary-item" id="summary4">
                        <div class="summary-name">Plant Identification</div>
                        <div class="summary-status">Not Completed</div>
                    </div>
                </div>

                <div class="final-result" id="finalResult">
                    <div class="final-score"></div>
                    <div class="final-message"></div>
                </div>
            </div>
        </div>

        <!-- Challenge 1: Animal Identification -->
        <div id="challenge1" class="challenge-section active">
            <div class="instructions">
                <h2>Challenge 1: Animal Identification</h2>
                <p>Identify which animals belong in the tundra biome. You need 12 out of 15 correct to pass this challenge.</p>
            </div>
            <div class="progress">Answered: <span id="progress1">0</span> / 15</div>
            <div class="challenge-grid" id="grid1"></div>
            <div class="submit-section">
                <button class="btn-submit" id="submit1" onclick="submitChallenge1()" disabled>Submit Answers</button>
            </div>
            <div class="results" id="results1"></div>
        </div>

        <!-- Challenge 2: Trivia Quiz -->
        <div id="challenge2" class="challenge-section">
            <div class="instructions">
                <h2>Challenge 2: Tundra Trivia</h2>
                <p>Test your knowledge about the tundra biome. You need 7 out of 10 correct to pass this challenge.</p>
            </div>
            <div class="progress">Answered: <span id="progress2">0</span> / 10</div>
            <div class="challenge-grid" id="grid2"></div>
            <div class="submit-section">
                <button class="btn-submit" id="submit2" onclick="submitChallenge2()" disabled>Submit Answers</button>
            </div>
            <div class="results" id="results2"></div>
        </div>

        <!-- Challenge 3: Matching -->
        <div id="challenge3" class="challenge-section">
            <div class="instructions">
                <h2>Challenge 3: Adaptation Matching</h2>
                <p>Match each tundra animal with its survival adaptation. Click an animal, then click its corresponding adaptation.</p>
            </div>
            <div class="progress">Matched: <span id="progress3">0</span> / 6</div>
            <div class="matching-grid" id="grid3"></div>
            <div class="submit-section">
                <button class="btn-submit" id="submit3" onclick="submitChallenge3()" disabled>Check Matches</button>
            </div>
            <div class="results" id="results3"></div>
        </div>

        <!-- Challenge 4: Plant Identification -->
        <div id="challenge4" class="challenge-section">
            <div class="instructions">
                <h2>Challenge 4: Tundra Plants</h2>
                <p>Identify which plants can survive in the tundra biome. You need 7 out of 10 correct to pass this challenge.</p>
            </div>
            <div class="progress">Answered: <span id="progress4">0</span> / 10</div>
            <div class="challenge-grid" id="grid4"></div>
            <div class="submit-section">
                <button class="btn-submit" id="submit4" onclick="submitChallenge4()" disabled>Submit Answers</button>
            </div>
            <div class="results" id="results4"></div>
        </div>
    </div>

    <script>
        // Create snowflakes
        function createSnowflakes() {
            for (let i = 0; i < 30; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerHTML = '❄';
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                snowflake.style.fontSize = (Math.random() * 1.5 + 0.5) + 'em';
                snowflake.style.opacity = Math.random() * 0.6 + 0.4;
                document.body.appendChild(snowflake);
            }
        }
        createSnowflakes();

        // Challenge 1 Data
        const animals = [
            { name: "Arctic Fox", tundra: true },
            { name: "Polar Bear", tundra: true },
            { name: "Lion", tundra: false },
            { name: "Caribou (Reindeer)", tundra: true },
            { name: "Musk Ox", tundra: true },
            { name: "Tiger", tundra: false },
            { name: "Snowy Owl", tundra: true },
            { name: "Lemming", tundra: true },
            { name: "Elephant", tundra: false },
            { name: "Arctic Hare", tundra: true },
            { name: "Kangaroo", tundra: false },
            { name: "Ptarmigan", tundra: true },
            { name: "Giraffe", tundra: false },
            { name: "Arctic Wolf", tundra: true },
            { name: "Monkey", tundra: false }
        ];

        // Challenge 2 Data
        const triviaQuestions = [
            { question: "What is the average winter temperature in the tundra?", options: ["0°C to 10°C", "-30°C to -10°C", "10°C to 20°C", "-5°C to 5°C"], correct: 1 },
            { question: "What does 'tundra' mean in Finnish?", options: ["Frozen land", "Treeless plain", "Cold desert", "Ice world"], correct: 1 },
            { question: "How long is the tundra growing season?", options: ["9-12 months", "6-9 months", "3-6 months", "50-60 days"], correct: 3 },
            { question: "What layer of permanently frozen soil is found in the tundra?", options: ["Cryosphere", "Permafrost", "Glacial layer", "Frozen substrate"], correct: 1 },
            { question: "Which tundra type is found at high elevations?", options: ["Arctic tundra", "Antarctic tundra", "Alpine tundra", "Coastal tundra"], correct: 2 },
            { question: "What percentage of Earth's land is tundra?", options: ["30%", "20%", "10%", "5%"], correct: 1 },
            { question: "What is the main limiting factor for plant growth in tundra?", options: ["Water", "Sunlight", "Temperature & short growing season", "Soil nutrients"], correct: 2 },
            { question: "What phenomenon gives 24-hour daylight in summer?", options: ["Solar flare", "Midnight sun", "Aurora borealis", "Polar day"], correct: 1 },
            { question: "Which is NOT a tundra location?", options: ["Alaska", "Northern Canada", "Sahara Desert", "Siberia"], correct: 2 },
            { question: "What type of precipitation is most common in tundra?", options: ["Rain", "Snow", "Hail", "Sleet"], correct: 1 }
        ];

        // Challenge 3 Data
        const matchingData = {
            animals: ["Arctic Fox", "Polar Bear", "Caribou", "Snowy Owl", "Musk Ox", "Ptarmigan"],
            adaptations: ["White fur changes to brown in summer", "Thick blubber layer for insulation", "Wide hooves for walking on snow", "Silent flight feathers for hunting", "Long shaggy coat reaching ground", "Feathered feet for warmth"]
        };
        
        // Shuffle function
        function shuffle(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Challenge 4 Data
        const plants = [
            { name: "Arctic Moss", tundra: true },
            { name: "Cotton Grass", tundra: true },
            { name: "Palm Tree", tundra: false },
            { name: "Labrador Tea", tundra: true },
            { name: "Bamboo", tundra: false },
            { name: "Arctic Poppy", tundra: true },
            { name: "Cactus", tundra: false },
            { name: "Lichen", tundra: true },
            { name: "Venus Flytrap", tundra: false },
            { name: "Arctic Willow", tundra: true }
        ];

        // State
        let userAnswers1 = {};
        let userAnswers2 = {};
        let userAnswers4 = {};
        let selectedAnimal = null;
        let selectedAdaptation = null;
        let matches = [];
        let challengeResults = {
            1: null,
            2: null,
            3: null,
            4: null
        };
        let challengeSubmitted = {
            1: false,
            2: false,
            3: false,
            4: false
        };
        let shuffledAnimals = [];
        let shuffledAdaptations = [];
        let animalIndexMap = {};
        let adaptationIndexMap = {};

        function switchChallenge(num) {
            document.querySelectorAll('.challenge-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.challenge-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`challenge${num}`).classList.add('active');
            event.target.classList.add('active');
        }

        function checkAllCompleted() {
            const completed = Object.values(challengeResults).every(result => result !== null);
            if (completed) {
                showFinalSummary();
            }
        }

        function showFinalSummary() {
            // Hide challenge selector and all challenge sections
            document.getElementById('challengeSelector').style.display = 'none';
            document.querySelectorAll('.challenge-section').forEach(s => s.classList.remove('active'));
            
            // Show final summary
            document.getElementById('finalSummary').classList.add('active');

            // Update summary items
            let passedCount = 0;
            for (let i = 1; i <= 4; i++) {
                const summaryItem = document.getElementById(`summary${i}`);
                const status = summaryItem.querySelector('.summary-status');
                
                if (challengeResults[i].passed) {
                    summaryItem.classList.add('passed');
                    status.textContent = `Passed (${challengeResults[i].score}/${challengeResults[i].total})`;
                    passedCount++;
                } else {
                    summaryItem.classList.add('failed');
                    status.textContent = `Failed (${challengeResults[i].score}/${challengeResults[i].total})`;
                }
            }

            // Update final result
            const finalResult = document.getElementById('finalResult');
            const finalScore = finalResult.querySelector('.final-score');
            const finalMessage = finalResult.querySelector('.final-message');
            
            finalScore.textContent = `${passedCount} / 4 Challenges Passed`;
            
            if (passedCount === 4) {
                finalResult.classList.add('overall-pass');
                finalMessage.textContent = 'Outstanding! You have successfully completed all challenges and proven your knowledge of the tundra biome. You may continue your journey.';
            } else if (passedCount >= 3) {
                finalResult.classList.add('overall-pass');
                finalMessage.textContent = 'Well done! You have passed most of the challenges and demonstrated solid understanding of the tundra biome. You may proceed.';
            } else {
                finalResult.classList.add('overall-fail');
                finalMessage.textContent = 'You need to pass at least 3 out of 4 challenges to complete this checkpoint. Please try again to continue your journey.';
            }

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize Challenge 1
        function initChallenge1() {
            const grid = document.getElementById('grid1');
            animals.forEach((animal, index) => {
                const card = document.createElement('div');
                card.className = 'animal-card';
                card.innerHTML = `
                    <div class="animal-name">${animal.name}</div>
                    <div class="button-group">
                        <button class="btn btn-yes" onclick="selectAnswer1(${index}, true)">YES</button>
                        <button class="btn btn-no" onclick="selectAnswer1(${index}, false)">NO</button>
                    </div>
                `;
                card.id = `card1-${index}`;
                grid.appendChild(card);
            });
        }

        function selectAnswer1(index, answer) {
            if (challengeSubmitted[1]) return;
            userAnswers1[index] = answer;
            const card = document.getElementById(`card1-${index}`);
            card.className = 'animal-card';
            card.classList.add(answer ? 'selected-yes' : 'selected-no');
            document.getElementById('progress1').textContent = Object.keys(userAnswers1).length;
            document.getElementById('submit1').disabled = Object.keys(userAnswers1).length < 15;
        }

        function submitChallenge1() {
            if (challengeSubmitted[1]) return;
            challengeSubmitted[1] = true;
            let correct = 0;
            const resultsHTML = [];
            animals.forEach((animal, index) => {
                const userAnswer = userAnswers1[index];
                const isCorrect = userAnswer === animal.tundra;
                if (isCorrect) correct++;
                resultsHTML.push(`
                    <div class="answer-item ${isCorrect ? 'correct' : 'incorrect'}">
                        <span>${animal.name}</span>
                        <span>${isCorrect ? 'Correct' : 'Wrong'} (${animal.tundra ? 'Tundra' : 'Not Tundra'})</span>
                    </div>
                `);
            });
            const passed = correct >= 12;
            challengeResults[1] = { passed: passed, score: correct, total: 15 };
            document.getElementById('results1').innerHTML = `
                <div class="score ${passed ? 'pass' : 'fail'}">
                    ${passed ? 'Challenge Passed' : 'Try Again'}
                </div>
                <h2 style="text-align: center;">Score: ${correct} / 15</h2>
                <div class="answer-list">${resultsHTML.join('')}</div>
            `;
            document.getElementById('results1').classList.add('show');
            document.getElementById('submit1').disabled = true;
            document.getElementById('results1').scrollIntoView({ behavior: 'smooth', block: 'start' });
            checkAllCompleted();
        }

        // Initialize Challenge 2
        function initChallenge2() {
            const grid = document.getElementById('grid2');
            triviaQuestions.forEach((q, index) => {
                const card = document.createElement('div');
                card.className = 'quiz-card';
                card.innerHTML = `
                    <div class="quiz-question">${q.question}</div>
                    <div class="button-group">
                        ${q.options.map((opt, i) => `
                            <button class="btn btn-option" onclick="selectAnswer2(${index}, ${i})">${opt}</button>
                        `).join('')}
                    </div>
                `;
                card.id = `card2-${index}`;
                grid.appendChild(card);
            });
        }

        function selectAnswer2(qIndex, optIndex) {
            if (challengeSubmitted[2]) return;
            userAnswers2[qIndex] = optIndex;
            const card = document.getElementById(`card2-${qIndex}`);
            card.querySelectorAll('.btn-option').forEach((btn, i) => {
                btn.classList.toggle('selected', i === optIndex);
            });
            document.getElementById('progress2').textContent = Object.keys(userAnswers2).length;
            document.getElementById('submit2').disabled = Object.keys(userAnswers2).length < 10;
        }

        function submitChallenge2() {
            if (challengeSubmitted[2]) return;
            challengeSubmitted[2] = true;
            let correct = 0;
            const resultsHTML = [];
            triviaQuestions.forEach((q, index) => {
                const userAnswer = userAnswers2[index];
                const isCorrect = userAnswer === q.correct;
                if (isCorrect) correct++;
                resultsHTML.push(`
                    <div class="answer-item ${isCorrect ? 'correct' : 'incorrect'}">
                        <span>${q.question}</span>
                        <span>${isCorrect ? 'Correct' : q.options[q.correct]}</span>
                    </div>
                `);
            });
            const passed = correct >= 7;
            challengeResults[2] = { passed: passed, score: correct, total: 10 };
            document.getElementById('results2').innerHTML = `
                <div class="score ${passed ? 'pass' : 'fail'}">
                    ${passed ? 'Challenge Passed' : 'Try Again'}
                </div>
                <h2 style="text-align: center;">Score: ${correct} / 10</h2>
                <div class="answer-list">${resultsHTML.join('')}</div>
            `;
            document.getElementById('results2').classList.add('show');
            document.getElementById('submit2').disabled = true;
            document.getElementById('results2').scrollIntoView({ behavior: 'smooth', block: 'start' });
            checkAllCompleted();
        }

        // Initialize Challenge 3
        function initChallenge3() {
            // Create shuffled arrays and maps
            shuffledAnimals = shuffle(matchingData.animals.map((animal, idx) => ({ text: animal, originalIdx: idx })));
            shuffledAdaptations = shuffle(matchingData.adaptations.map((adapt, idx) => ({ text: adapt, originalIdx: idx })));
            
            const grid = document.getElementById('grid3');
            grid.innerHTML = `
                <div class="matching-column">
                    <h3>Animals</h3>
                    ${shuffledAnimals.map((animal, i) => `
                        <div class="matching-item" id="animal-${i}" onclick="selectMatch('animal', ${i})">${animal.text}</div>
                    `).join('')}
                </div>
                <div class="matching-column">
                    <h3>Adaptations</h3>
                    ${shuffledAdaptations.map((adapt, i) => `
                        <div class="matching-item" id="adapt-${i}" onclick="selectMatch('adapt', ${i})">${adapt.text}</div>
                    `).join('')}
                </div>
            `;
        }

        function selectMatch(type, index) {
            if (challengeSubmitted[3]) return;
            if (type === 'animal') {
                if (document.getElementById(`animal-${index}`).classList.contains('matched')) return;
                if (selectedAnimal !== null) {
                    document.getElementById(`animal-${selectedAnimal}`).classList.remove('selected');
                }
                selectedAnimal = index;
                document.getElementById(`animal-${index}`).classList.add('selected');
            } else {
                if (document.getElementById(`adapt-${index}`).classList.contains('matched')) return;
                if (selectedAdaptation !== null) {
                    document.getElementById(`adapt-${selectedAdaptation}`).classList.remove('selected');
                }
                selectedAdaptation = index;
                document.getElementById(`adapt-${index}`).classList.add('selected');
            }

            if (selectedAnimal !== null && selectedAdaptation !== null) {
                matches.push({ 
                    animal: selectedAnimal, 
                    adapt: selectedAdaptation,
                    animalOriginal: shuffledAnimals[selectedAnimal].originalIdx,
                    adaptOriginal: shuffledAdaptations[selectedAdaptation].originalIdx
                });
                document.getElementById(`animal-${selectedAnimal}`).classList.add('matched');
                document.getElementById(`adapt-${selectedAdaptation}`).classList.add('matched');
                document.getElementById(`animal-${selectedAnimal}`).classList.remove('selected');
                document.getElementById(`adapt-${selectedAdaptation}`).classList.remove('selected');
                selectedAnimal = null;
                selectedAdaptation = null;
                document.getElementById('progress3').textContent = matches.length;
                document.getElementById('submit3').disabled = matches.length < 6;
            }
        }

        function submitChallenge3() {
            if (challengeSubmitted[3]) return;
            challengeSubmitted[3] = true;
            let correct = 0;
            const resultsHTML = [];
            matches.forEach(match => {
                const isCorrect = match.animalOriginal === match.adaptOriginal;
                if (isCorrect) correct++;
                resultsHTML.push(`
                    <div class="answer-item ${isCorrect ? 'correct' : 'incorrect'}">
                        <span>${shuffledAnimals[match.animal].text} → ${shuffledAdaptations[match.adapt].text}</span>
                        <span>${isCorrect ? 'Correct' : 'Wrong'}</span>
                    </div>
                `);
            });
            const passed = correct >= 5;
            challengeResults[3] = { passed: passed, score: correct, total: 6 };
            document.getElementById('results3').innerHTML = `
                <div class="score ${passed ? 'pass' : 'fail'}">
                    ${passed ? 'Challenge Passed' : 'Try Again'}
                </div>
                <h2 style="text-align: center;">Score: ${correct} / 6</h2>
                <div class="answer-list">${resultsHTML.join('')}</div>
            `;
            document.getElementById('results3').classList.add('show');
            document.getElementById('submit3').disabled = true;
            document.getElementById('results3').scrollIntoView({ behavior: 'smooth', block: 'start' });
            checkAllCompleted();
        }

        // Initialize Challenge 4
        function initChallenge4() {
            const grid = document.getElementById('grid4');
            plants.forEach((plant, index) => {
                const card = document.createElement('div');
                card.className = 'animal-card';
                card.innerHTML = `
                    <div class="animal-name">${plant.name}</div>
                    <div class="button-group">
                        <button class="btn btn-yes" onclick="selectAnswer4(${index}, true)">YES</button>
                        <button class="btn btn-no" onclick="selectAnswer4(${index}, false)">NO</button>
                    </div>
                `;
                card.id = `card4-${index}`;
                grid.appendChild(card);
            });
        }

        function selectAnswer4(index, answer) {
            if (challengeSubmitted[4]) return;
            userAnswers4[index] = answer;
            const card = document.getElementById(`card4-${index}`);
            card.className = 'animal-card';
            card.classList.add(answer ? 'selected-yes' : 'selected-no');
            document.getElementById('progress4').textContent = Object.keys(userAnswers4).length;
            document.getElementById('submit4').disabled = Object.keys(userAnswers4).length < 10;
        }

        function submitChallenge4() {
            if (challengeSubmitted[4]) return;
            challengeSubmitted[4] = true;
            let correct = 0;
            const resultsHTML = [];
            plants.forEach((plant, index) => {
                const userAnswer = userAnswers4[index];
                const isCorrect = userAnswer === plant.tundra;
                if (isCorrect) correct++;
                resultsHTML.push(`
                    <div class="answer-item ${isCorrect ? 'correct' : 'incorrect'}">
                        <span>${plant.name}</span>
                        <span>${isCorrect ? 'Correct' : 'Wrong'} (${plant.tundra ? 'Tundra' : 'Not Tundra'})</span>
                    </div>
                `);
            });
            const passed = correct >= 7;
            challengeResults[4] = { passed: passed, score: correct, total: 10 };
            document.getElementById('results4').innerHTML = `
                <div class="score ${passed ? 'pass' : 'fail'}">
                    ${passed ? 'Challenge Passed' : 'Try Again'}
                </div>
                <h2 style="text-align: center;">Score: ${correct} / 10</h2>
                <div class="answer-list">${resultsHTML.join('')}</div>
            `;
            document.getElementById('results4').classList.add('show');
            document.getElementById('submit4').disabled = true;
            document.getElementById('results4').scrollIntoView({ behavior: 'smooth', block: 'start' });
            checkAllCompleted();
        }

        // Initialize all challenges
        initChallenge1();
        initChallenge2();
        initChallenge3();
        initChallenge4();
    </script>
</body>
</html>
